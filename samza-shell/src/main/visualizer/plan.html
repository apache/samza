<!doctype html>

<meta charset="utf-8">
<title>SAMZA Visualizer</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<script src="js/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript" src="js/dagre-d3.js"></script>
<script type="text/javascript" src="js/planToDagre.js"></script>
<script type="text/javascript" src="plan.json"></script>

<h1>SAMZA Visualizer</h1>

<style id="css">
  body {
    font: 300 14px 'Helvetica Neue', Helvetica;
  }

  svg {
    margin-top: 30px;
  }

  .node rect {
    stroke: #999;
    fill: #E8E8EE;
    stroke-width: 1.5px;
  }

  .node ellipse {
    stroke: #999;
    fill: #fff;
    stroke-width: 1.5px;
  }

  .edgePath path {
    stroke: #333;
    stroke-width: 1.5px;
  }

  g.source > ellipse {
    fill: #BDEDFF;
  }

  g.sink > ellipse {
    fill: #BDEDFF;
  }

  g.intermediate > ellipse {
    fill: #C3FDB8;
  }

  .topbar {
    text-align: center;
    border-bottom: solid;
    border-bottom-color: #cdcfd2;
    border-bottom-width: 1px;
  }

  .detailBox{
    margin-top: -10px;
  }
</style>

<section>
  <p id="summary"/>
</section>

<svg id="svg-canvas" width=1200 height=1000><g/></svg>

<script id="js">
  var data = JSON.parse(plan);
  var g = planToDagre(data);

  var summary = "A visualization of application <b>" + data.ApplicationName + "-" + data.ApplicationId + "</b>";
  summary += ", which consists of " + data.Jobs.length + " job(s), ";
  summary += Object.keys(data.SourceStreams).length + " input stream(s), and ";
  summary += Object.keys(data.SinkStreams).length + " output stream(s)."
  document.getElementById("summary").innerHTML = summary;

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("svg"),
      inner = svg.select("g");

  // Set up zoom support
  var zoom = d3.behavior.zoom().on("zoom", function() {
      inner.attr("transform", "translate(" + d3.event.translate + ")" +
                                  "scale(" + d3.event.scale + ")");
    });
  svg.call(zoom);

  // Create the renderer
  var render = new dagreD3.render();

  // Run the renderer. This is what draws the final graph.
  render(inner, g);

  // Center the graph
  var initialScale = 0.6;
  zoom.scale(initialScale).event(svg);
  svg.attr('height', g.graph().height * initialScale + 100);
</script>
